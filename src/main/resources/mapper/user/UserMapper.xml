<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.routy.routyback.mapper.user.UserMapper">

    <!-- User resultMap -->
    <resultMap id="UserResultMap" type="com.routy.routyback.domain.user.User">
        <id property="userNo" column="USERNO"/>
        <result property="userId" column="USERID"/>
        <result property="userPw" column="USERPW"/>
        <result property="userName" column="USERNAME"/>
        <result property="userHp" column="USERHP"/>
        <result property="userEmail" column="USEREMAIL"/>
        <result property="userZip" column="USERZIP"/>
        <result property="userJibunAddr" column="USERJIBUNADDR"/>
        <result property="userRoadAddr" column="USERROADADDR"/>
        <result property="userDetailAddr" column="USERDETAILADDR"/>
        <result property="userBirth" column="USERBIRTH"/>
        <result property="userLevel" column="USERLEVEL"/>
        <result property="userRegdate" column="USERREGDATE"/>
        <result property="userStatus" column="USERSTATUS"/>
    </resultMap>

    <!-- 회원가입 -->
    <insert id="insertUser" parameterType="com.routy.routyback.domain.user.User">
        INSERT INTO USERS (USERNO,
                           USERID,
                           USERPW,
                           USERNAME,
                           USERHP,
                           USEREMAIL,
                           USERZIP,
                           USERJIBUNADDR,
                           USERROADADDR,
                           USERDETAILADDR,
                           USERBIRTH,
                           USERLEVEL,
                           USERREGDATE)
        VALUES (ISEQ$$_119796.NEXTVAL,
                #{userId, jdbcType=VARCHAR},
                #{userPw, jdbcType=VARCHAR},
                #{userName, jdbcType=VARCHAR},
                #{userHp, jdbcType=VARCHAR},
                #{userEmail, jdbcType=VARCHAR},
                #{userZip, jdbcType=NUMERIC},
                #{userJibunAddr, jdbcType=VARCHAR},
                #{userRoadAddr, jdbcType=VARCHAR},
                #{userDetailAddr, jdbcType=VARCHAR},
                #{userBirth, jdbcType=DATE},
                1,
                SYSDATE)
    </insert>

    <!-- 이메일로 사용자 조회 -->
    <select id="findByEmail" parameterType="string" resultMap="UserResultMap">
        SELECT USERNO,
               USERID,
               USERPW,
               USERNAME,
               USERHP,
               USEREMAIL,
               USERZIP,
               USERJIBUNADDR,
               USERROADADDR,
               USERDETAILADDR,
               USERBIRTH,
               USERLEVEL,
               USERREGDATE,
               USERSTATUS
        FROM USERS
        WHERE USEREMAIL = #{email, jdbcType=VARCHAR}
          AND USERSTATUS = 1
    </select>

    <!-- 이메일 중복 체크 -->
    <select id="existsByEmail" parameterType="string" resultType="boolean">
        SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
        FROM USERS
        WHERE USEREMAIL = #{email, jdbcType=VARCHAR}
    </select>

    <!-- userId로 사용자 조회 -->
    <select id="findByUserId" parameterType="string" resultMap="UserResultMap">
        SELECT USERNO,
               USERID,
               USERPW,
               USERNAME,
               USERHP,
               USEREMAIL,
               USERZIP,
               USERJIBUNADDR,
               USERROADADDR,
               USERDETAILADDR,
               USERBIRTH,
               USERLEVEL,
               USERREGDATE,
               USERSTATUS
        FROM USERS
        WHERE USERID = #{userId, jdbcType=VARCHAR}
          AND USERSTATUS = 1
    </select>

    <!-- userId로 userNo 조회 -->
    <select id="findUserNoByUserId" parameterType="string" resultType="long">
        SELECT USERNO
        FROM USERS
        WHERE USERID = #{userId, jdbcType=VARCHAR}
          AND USERSTATUS = 1
    </select>

</mapper>